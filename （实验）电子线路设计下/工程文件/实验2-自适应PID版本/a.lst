C51 COMPILER V9.52.0.0   A                                                                 04/20/2022 21:34:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE A
OBJECT MODULE PLACED IN a.obj
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE source\a.c LARGE RTX51 BROWSE DEBUG OBJECTEXTEND PRINT(.\a.lst) TABS(2)
                    - OBJECT(a.obj)

line level    source

   1          #include <stdio.h>
   2          #include <math.h>
   3          #include <stdlib.h>
   4          #define NB -3
   5          #define NM -2
   6          #define NS -1
   7          #define ZO 0
   8          #define PS 1
   9          #define PM 2
  10          #define PB 3
  11          
  12          void FuzzyPID();  //åˆå§‹åŒ–PIDå‚æ•°
  13          float FuzzyPIDcontroller(float e_max, float e_min, float ec_max, float ec_min, float kp_max, float kp_min,
             - float error, float error_c, float ki_max, float ki_min,float kd_max, float kd_min,float error_pre, float error_ppre);  
             -//æ¨¡ç³ŠPIDæ§åˆ¶å®ç°å‡½æ•°
  14          float Quantization(float maximum, float minimum, float x);  //è¯¯å·® error å’Œè¯¯å·®å˜åŒ– error_c æ˜ å°„åˆ
             -°è®ºåŸŸä¸­çš„å‡½æ•°
  15          void Get_grad_membership(float error, float error_c); ////è®¡ç®—è¾“å…¥eä¸de/dtéš¶å±åº¦
  16          void GetSumGrad();// è·å–è¾“å‡ºå¢é‡ â–³kpã€â–³kiã€â–³kd çš„æ€»éš¶å±åº¦
  17          void GetOUT();  // è®¡ç®—è¾“å‡ºå¢é‡ â–³kpã€â–³kiã€â–³kd å¯¹åº”è®ºåŸŸå€¼
  18          float Inverse_quantization(float maximum, float minimum, float qvalues);  //å»æ¨¡ç³ŠåŒ–
  19          
  20          
  21          const int  num_area = 8; //åˆ’åˆ†åŒºåŸŸä¸ªæ•°
  22          float e_membership_values[7] = {-3,-2,-1,0,1,2,3}; //è¾“å…¥eçš„éš¶å±å€¼
  23          float ec_membership_values[7] = { -3,-2,-1,0,1,2,3 };//è¾“å…¥de/dtçš„éš¶å±å€¼
  24          float kp_menbership_values[7] = { -3,-2,-1,0,1,2,3 };//è¾“å‡ºå¢é‡kpçš„éš¶å±å€¼
  25          float ki_menbership_values[7] = { -3,-2,-1,0,1,2,3 }; //è¾“å‡ºå¢é‡kiçš„éš¶å±å€¼
  26          float kd_menbership_values[7] = { -3,-2,-1,0,1,2,3 };  //è¾“å‡ºå¢é‡kdçš„éš¶å±å€¼
  27          
  28          float kp;                       //PIDå‚æ•°kp
  29          float ki;                       //PIDå‚æ•°ki
  30          float kd;                       //PIDå‚æ•°kd
  31          float qdetail_kp;               //å¢é‡kpå¯¹åº”è®ºåŸŸä¸­çš„å€¼
  32          float qdetail_ki;               //å¢é‡kiå¯¹åº”è®ºåŸŸä¸­çš„å€¼
  33          float qdetail_kd;               //å¢é‡kdå¯¹åº”è®ºåŸŸä¸­çš„å€¼
  34          float detail_kp;                //è¾“å‡ºå¢é‡kp
  35          float detail_ki;                //è¾“å‡ºå¢é‡ki
  36          float detail_kd;                //è¾“å‡ºå¢é‡kd
  37          float qerror;                    //è¾“å…¥eå¯¹åº”è®ºåŸŸä¸­çš„å€¼
  38          float qerror_c;                  //è¾“å…¥de/dtå¯¹åº”è®ºåŸŸä¸­çš„å€¼             
  39          float e_gradmembership[2];      //è¾“å…¥eçš„éš¶å±åº¦
  40          float ec_gradmembership[2];     //è¾“å…¥de/dtçš„éš¶å±åº¦
  41          int e_grad_index[2];            //è¾“å…¥eéš¶å±åº¦åœ¨è§„åˆ™è¡¨çš„ç´¢å¼•
  42          int ec_grad_index[2];           //è¾“å…¥de/dtéš¶å±åº¦åœ¨è§„åˆ™è¡¨çš„ç´¢å¼•
  43          float KpgradSums[7] = { 0,0,0,0,0,0,0 };   //è¾“å‡ºå¢é‡kpæ€»çš„éš¶å±åº¦
  44          float KigradSums[7] = { 0,0,0,0,0,0,0 };   //è¾“å‡ºå¢é‡kiæ€»çš„éš¶å±åº¦
  45          float KdgradSums[7] = { 0,0,0,0,0,0,0 };   //è¾“å‡ºå¢é‡kdæ€»çš„éš¶å±åº¦
  46          
  47          float e_max = 150;      //è¯¯å·®æœ€å¤§å€¼
  48          float e_min = -150;    //è¯¯å·®æœ€å°å€¼
  49          float ec_max = 300;     //è¯¯å·®å˜åŒ–æœ€å¤§å€¼
  50          float ec_min = -300;    //è¯¯å·®å˜åŒ–æœ€å°å€¼
  51          float kp_max = 50;       //æ¯”ä¾‹ç³»æ•° kp ä¸Šé™å€¼
C51 COMPILER V9.52.0.0   A                                                                 04/20/2022 21:34:21 PAGE 2   

  52          float kp_min = -50;    //æ¯”ä¾‹ç³»æ•° kp ä¸‹é™å€¼
  53          float ki_max = 0.1;     //ç§¯åˆ†ç³»æ•° ki ä¸Šé™å€¼
  54          float ki_min = -0.1;    //ç§¯åˆ†ç³»æ•° ki ä¸‹é™å€¼
  55          float kd_max = 0.01;    //å¾®åˆ†ç³»æ•° kd ä¸Šé™å€¼
  56          float kd_min = -0.01;   //å¾®åˆ†ç³»æ•° kd ä¸‹é™å€¼
  57          float error;        //è¯¯å·®å€¼
  58          float error_c;      //è¯¯å·®å˜åŒ–å€¼
  59          float error_pre = 0;    //ä¸Šä¸€æ¬¡è¯¯å·®å€¼
  60          float error_ppre = 0;   //ä¸Šä¸Šæ¬¡è¯¯å·®å€¼
  61          
  62          
  63          int  Kp_rule_list[7][7] = { {PB,PB,PM,PM,PS,ZO,ZO},        //kpè§„åˆ™è¡¨
  64                       {PB,PB,PM,PS,PS,ZO,NS},
  65                       {PM,PM,PM,PS,ZO,NS,NS},
  66                       {PM,PM,PS,ZO,NS,NM,NM},
  67                       {PS,PS,ZO,NS,NS,NM,NM},
  68                       {PS,ZO,NS,NM,NM,NM,NB},
  69                       {ZO,ZO,NM,NM,NM,NB,NB} };
  70          
  71          int  Ki_rule_list[7][7] = { {NB,NB,NM,NM,NS,ZO,ZO},     //kiè§„åˆ™è¡¨
  72                      {NB,NB,NM,NS,NS,ZO,ZO},
  73                      {NB,NM,NS,NS,ZO,PS,PS},
  74                      {NM,NM,NS,ZO,PS,PM,PM},
  75                      {NM,NS,ZO,PS,PS,PM,PB},
  76                      {ZO,ZO,PS,PS,PM,PB,PB},
  77                      {ZO,ZO,PS,PM,PM,PB,PB} };
  78          
  79            int  Kd_rule_list[7][7] = { {PS,NS,NB,NB,NB,NM,PS},     //kdè§„åˆ™è¡¨
  80                       {PS,NS,NB,NM,NM,NS,ZO},
  81                       {ZO,NS,NM,NM,NS,NS,ZO},
  82                       {ZO,NS,NS,NS,NS,NS,ZO},
  83                       {ZO,ZO,ZO,ZO,ZO,ZO,ZO},
  84                                     {PB,NS,PS,PS,PS,PS,PB},
  85                                     {PB,PM,PM,PM,PS,PS,PB} };
  86          
  87          void FuzzyPID()  //å‚æ•°åˆå§‹åŒ–
  88          {
  89   1        kp = 0;
  90   1        ki = 0;
  91   1        kd = 0;
  92   1        qdetail_kp = 0;
  93   1        qdetail_ki = 0;
  94   1        qdetail_kd = 0;
  95   1      }
  96          
  97          //æ¨¡ç³ŠPIDæ§åˆ¶å®ç°å‡½æ•°
  98          float FuzzyPIDcontroller(float e_max, float e_min, float ec_max, float ec_min, float kp_max, float kp_min,
             - float error, float error_c,float ki_max,float ki_min,float kd_max,float kd_min,float error_pre,float error_ppre)
  99          {
 100   1        float output;
 101   1        qerror = Quantization(e_max, e_min, error);    //å°† è¯¯å·® error æ˜ å°„åˆ°è®ºåŸŸä¸­
 102   1        qerror_c = Quantization(ec_max, ec_min, error_c);   //å°†è¯¯å·®å˜åŒ– error_c æ˜ å°„åˆ°è®ºåŸŸä¸­
 103   1        Get_grad_membership(qerror, qerror_c);  //è®¡ç®—è¯¯å·® error å’Œè¯¯å·®å˜åŒ– error_c çš„éš¶å±åº¦
 104   1        GetSumGrad(); //è®¡ç®—è¾“å‡ºå¢é‡ â–³kpã€â–³kiã€â–³kd çš„æ€»éš¶å±åº¦
 105   1        GetOUT();   // è®¡ç®—è¾“å‡ºå¢é‡ â–³kpã€â–³kiã€â–³kd å¯¹åº”è®ºåŸŸå€¼
 106   1        detail_kp = Inverse_quantization(kp_max, kp_min, qdetail_kp);    //å»æ¨¡ç³ŠåŒ–å¾—åˆ°å¢é‡ â–³kp
 107   1        detail_ki = Inverse_quantization(ki_max, ki_min, qdetail_ki);    //å»æ¨¡ç³ŠåŒ–å¾—åˆ°å¢é‡ â–³ki
 108   1        detail_kd = Inverse_quantization(kd_max, kd_min, qdetail_kd);    //å»æ¨¡ç³ŠåŒ–å¾—åˆ°å¢é‡ â–³kd
 109   1        qdetail_kd = 0;
 110   1        qdetail_ki = 0;
 111   1        qdetail_kp = 0;
 112   1        kp = kp + detail_kp;    //å¾—åˆ°æœ€ç»ˆçš„ kp å€¼
C51 COMPILER V9.52.0.0   A                                                                 04/20/2022 21:34:21 PAGE 3   

 113   1        ki = ki + detail_ki;    //å¾—åˆ°æœ€ç»ˆçš„ ki å€¼
 114   1        kd = kd + detail_kd;    //å¾—åˆ°æœ€ç»ˆçš„ kd å€¼
 115   1        if (kp < 0){
 116   2          kp = 0;}
 117   1        if (ki < 0){
 118   2          ki = 0;}
 119   1        if (kd < 0){
 120   2          kd = 0;}
 121   1        detail_kp = 0;
 122   1        detail_ki = 0;
 123   1        detail_kd = 0;
 124   1        output = kp*(error - error_pre) + ki * error + kd * (error - 2 * error_pre + error_ppre);   //è®¡ç®—æœ€ç
             -»ˆçš„è¾“å‡º
 125   1        return output;
 126   1      }
 127          
 128           
 129          ///åŒºé—´æ˜ å°„å‡½æ•°
 130          float Quantization(float maximum,float minimum,float x)
 131          {
 132   1        float qvalues= 6.0 *(x-minimum)/(maximum - minimum)-3;
 133   1        return qvalues;
 134   1      }
 135           
 136          //è¾“å…¥eä¸de/dtéš¶å±åº¦è®¡ç®—å‡½æ•°
 137          void Get_grad_membership(float error,float error_c)   
 138          {
 139   1        int i;
 140   1        if (error > e_membership_values[0] && error < e_membership_values[6])
 141   1        {
 142   2          for ( i = 0; i < num_area - 2; i++)
 143   2          {
 144   3            if (error >= e_membership_values[i] && error <= e_membership_values[i + 1])
 145   3            {
 146   4              e_gradmembership[0] = -(error - e_membership_values[i + 1]) / (e_membership_values[i + 1] - e_membersh
             -ip_values[i]);
 147   4              e_gradmembership[1] = 1+(error - e_membership_values[i + 1]) / (e_membership_values[i + 1] - e_members
             -hip_values[i]);
 148   4              e_grad_index[0] = i;
 149   4              e_grad_index[1] = i + 1;
 150   4              break;
 151   4            }
 152   3          }
 153   2        }
 154   1        else
 155   1        {
 156   2          if (error <= e_membership_values[0])
 157   2          {
 158   3            e_gradmembership[0] = 1;
 159   3            e_gradmembership[1] = 0;
 160   3            e_grad_index[0] = 0;
 161   3            e_grad_index[1] = -1;
 162   3          }
 163   2          else if (error >= e_membership_values[6])
 164   2          {
 165   3            e_gradmembership[0] = 1;
 166   3            e_gradmembership[1] = 0;
 167   3            e_grad_index[0] = 6;
 168   3            e_grad_index[1] = -1;
 169   3          }
 170   2        }
 171   1       
C51 COMPILER V9.52.0.0   A                                                                 04/20/2022 21:34:21 PAGE 4   

 172   1        if (error_c > ec_membership_values[0] && error_c < ec_membership_values[6])
 173   1        {
 174   2          for ( i = 0; i < num_area - 2; i++)
 175   2          {
 176   3            if (error_c >= ec_membership_values[i] && error_c <= ec_membership_values[i + 1])
 177   3            {
 178   4              ec_gradmembership[0] = -(error_c - ec_membership_values[i + 1]) / (ec_membership_values[i + 1] - ec_me
             -mbership_values[i]);
 179   4              ec_gradmembership[1] = 1 + (error_c - ec_membership_values[i + 1]) / (ec_membership_values[i + 1] - ec
             -_membership_values[i]);
 180   4              ec_grad_index[0] = i;
 181   4              ec_grad_index[1] = i + 1;
 182   4              break;
 183   4            }
 184   3          }
 185   2        }
 186   1        else
 187   1        {
 188   2          if (error_c <= ec_membership_values[0])
 189   2          {
 190   3            ec_gradmembership[0] = 1;
 191   3            ec_gradmembership[1] = 0;
 192   3            ec_grad_index[0] = 0;
 193   3            ec_grad_index[1] = -1;
 194   3          }
 195   2          else if (error_c >= ec_membership_values[6])
 196   2          {
 197   3            ec_gradmembership[0] = 1;
 198   3            ec_gradmembership[1] = 0;
 199   3            ec_grad_index[0] = 6;
 200   3            ec_grad_index[1] = -1;
 201   3          }
 202   2        }
 203   1       
 204   1      }
 205           
 206          // è·å–è¾“å‡ºå¢é‡kp,ki,kdçš„æ€»éš¶å±åº¦
 207          void GetSumGrad()
 208          {
 209   1        int i;
 210   1        int j;
 211   1      
 212   1          // åˆå§‹åŒ– Kpã€Kiã€Kd æ€»çš„éš¶å±åº¦å€¼ä¸º 0
 213   1                      
 214   1        for ( i = 0; i <= num_area - 1; i++)
 215   1        {
 216   2          KpgradSums[i] = 0;
 217   2          KigradSums[i] = 0;
 218   2                  KdgradSums[i] = 0;
 219   2        }
 220   1      
 221   1            for ( i = 0; i < 2; i++)
 222   1           {
 223   2                  if (e_grad_index[i] == -1)
 224   2                  {
 225   3                        continue;
 226   3                }
 227   2                  for ( j = 0; j < 2; j++)
 228   2                {
 229   3                        if (ec_grad_index[j] != -1)
 230   3                        {
 231   4                            int indexKp = Kp_rule_list[e_grad_index[i]][ec_grad_index[j]] + 3;
C51 COMPILER V9.52.0.0   A                                                                 04/20/2022 21:34:21 PAGE 5   

 232   4                            int indexKi = Ki_rule_list[e_grad_index[i]][ec_grad_index[j]] + 3;
 233   4                            int indexKd = Kd_rule_list[e_grad_index[i]][ec_grad_index[j]] + 3;
 234   4                            KpgradSums[indexKp]= KpgradSums[indexKp] + (e_gradmembership[i] * ec_gradmembership[j])
             -;
 235   4                            KigradSums[indexKi] = KigradSums[indexKi] + (e_gradmembership[i] * ec_gradmembership[j]
             -);
 236   4                            KdgradSums[indexKd] = KdgradSums[indexKd] + (e_gradmembership[i] * ec_gradmembership[j]
             -);
 237   4                        }
 238   3                        else
 239   3                        {
 240   4                            continue;
 241   4                        }
 242   3                  }
 243   2         }
 244   1      }
 245           
 246          // è®¡ç®—è¾“å‡ºå¢é‡kp,kd,kiå¯¹åº”è®ºåŸŸå€¼
 247          void GetOUT()
 248          {
 249   1        int i;
 250   1        for ( i = 0; i < num_area - 1; i++)
 251   1        {
 252   2          qdetail_kp += kp_menbership_values[i] * KpgradSums[i];
 253   2          qdetail_ki += ki_menbership_values[i] * KigradSums[i];
 254   2          qdetail_kd += kd_menbership_values[i] * KdgradSums[i];
 255   2        }
 256   1      }
 257           
 258          //ååŒºé—´æ˜ å°„å‡½æ•°
 259          float Inverse_quantization(float maximum, float minimum, float qvalues)
 260          {
 261   1        float x = (maximum - minimum) *(qvalues + 3)/6 + minimum;
 262   1        return x;
 263   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4079    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    644     102
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
