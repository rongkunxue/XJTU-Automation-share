C51 COMPILER V9.52.0.0   ADC                                                               04/20/2022 22:04:10 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN ADC.obj
COMPILER INVOKED BY: C:\Keil_v51\C51\BIN\C51.EXE source\ADC.c LARGE RTX51 BROWSE DEBUG OBJECTEXTEND PRINT(.\ADC.lst) TAB
                    -S(2) OBJECT(ADC.obj)

line level    source

   1          #include "ADC.h"
   2          
   3          unsigned int buf[2];
   4          unsigned char ch = 0;  // å†…éƒ¨å˜é‡ä½¿ç”¨ç¼©å†™é¿å…ä¸å¤–éƒ¨å†²çª
   5          
   6          void Timer3_Init_ADC0(int counts) {
   7   1          Timer3_Stop;                   // æ¸…é™¤ TMR3CN ä¸­æ–­æ ‡å¿—ä½ 2ï¼Œå®šæ—¶å™¨ 3 ç¦æ­¢ï¼ˆé‡ç½®æ‰€æœ‰ç
             -Š¶æ€ï¼‰
   8   1          Timer3_Reload_Init = -counts;  // ä½¿ç”¨ TMR3RL = -counts é‡è½½å®šæ—¶å™¨ 3
   9   1      //    Timer3_Reload_Init = 0x0000;  // ä½¿ç”¨ TMR3RL = -counts é‡è½½å®šæ—¶å™¨ 3
  10   1          Timer3_Count_Start;            // è®¾ç½® TMR3 è®¡æ»¡æº¢å‡ºï¼Œç«‹å³è£…è½½
  11   1          Disable_Timer3;                // æ¸…é™¤ EIE2 æ ‡å¿—ä½ 0ï¼Œç¦æ­¢å®šæ—¶å™¨ 3 ä¸­æ–­
  12   1          Timer3_Start;                  // è®¾å®š TMR3CN ä¸­æ–­æ ‡å¿—ä½ 2ï¼Œå®šæ—¶å™¨ 3 å¼€å¯
  13   1      }
  14          
  15          void ADC0_Init(void) {
  16   1          ADC0_Ctr_Set;    // ADC0 æ§åˆ¶è®¾ç½®ï¼Œå®šæ—¶å™¨ 3 æº¢å‡ºå¯åŠ¨è·Ÿè¸ªï¼ŒæŒç»­ä¸‰ä¸ª SAR æ—¶é’Ÿï¼Œç„¶
             -åè¿›è¡Œ AD è½¬æ¢ï¼Œæ•°æ®å³å¯¹é½
  17   1          REF_Ctr_Set;     // å…³é—­æ¸©åº¦ä¼ æ„Ÿå™¨, è®¾å®šèŠ¯ç‰‡ä¸Šçš„ VREF
  18   1          ADC0_Channel_1;  // ADC0 ä½¿ç”¨ AIN1 é€šé“
  19   1          ADC0_Clk_Set;    // è®¾ç½® ADC0 SAR è½¬æ¢æ—¶é’Ÿå‘¨æœŸä¸º 2.5MHz
  20   1          ADC0_Gain;       // ADC0 å¢ç›Šè®¾ç½®ï¼Œè®¾å®š ACD0 çš„å¢ç›Šä¸º 1
  21   1          Enable_ADC0;     // è®¾å®š EIE2 æ ‡å¿—ä½ 1ï¼Œå…è®¸ ADC0 è½¬æ¢ç»“æŸäº§ç”Ÿçš„ä¸­æ–­è¯·æ±‚
  22   1      }
  23          
  24          void ADC0_Enable(unsigned char flag) {
  25   1          if (flag) {
  26   2              ADC0_Start;         // è®¾å®š ADC0CN å…è®¸ä½ï¼ŒADC0 ä¸­æ–­å…è®¸
  27   2              // Disable_Global;  // ç¦æ­¢å…¨å±€ä¸­æ–­
  28   2          } else
  29   1              ADC0_Stop;          // æ¸…é™¤ ADC0CN å…è®¸ä½ï¼ŒADC0 ä¸­æ–­ç¦æ­¢
  30   1      }
  31          
  32          void ADC0_ISR(void) interrupt 15 {
  33   1          ADC0_IntFlag_Clear;      // æ¸…é™¤ ADC0CN è½¬æ¢ç»“æŸä¸­æ–­æ ‡å¿—ä½ï¼Œå¿…é¡»ä½¿ç”¨è½¯ä»¶æ¸…é›¶
  34   1          buf[ch] = ADC_Value(0);  // è¯» ADC0 ä¸­ AIN é€šé“çš„å€¼
  35   1          ch++;                    // æ”¹å˜é€šé“
  36   1          if (ch == 2)
  37   1              ch = 0;
  38   1          AMX0SL = ch;             // è®¾ç½®muxåˆ°ä¸‹ä¸ªé€šé“
  39   1          
  40   1          timer3_value++;
  41   1      }
  42          
  43          unsigned int ADC_Value(unsigned char Flag) {
  44   1          unsigned int temp, temp0, temp1;
  45   1          if (Flag)     // ADC1
  46   1              temp0 = ADC1;
  47   1          else          // ADC0
  48   1          {
  49   2              temp0 = ADC0L;
  50   2              temp1 = ADC0H;
  51   2          }
  52   1          temp = temp1 * 256 + temp0;
C51 COMPILER V9.52.0.0   ADC                                                               04/20/2022 22:04:10 PAGE 2   

  53   1          return temp;  // å–å›ADCè½¬æ¢æ•°æ®
  54   1      }
  55          
  56          unsigned int ADC_ValueReturn(unsigned char ch) {
  57   1          if (ch < 2)          // é€šé“èŒƒå›´æœ‰æ•ˆ
  58   1              return buf[ch];  // å–å›é€šé“å¯¹åº”æ•°æ®
  59   1          else                      // é€šé“èŒƒå›´å‡ºé”™
  60   1              return 0xffff;        // è¿”å›é”™è¯¯ä¿¡æ¯
  61   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    228    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
